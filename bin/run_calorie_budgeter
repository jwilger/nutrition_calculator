#!/usr/bin/env ruby

case ARGV[0]
when nil, '-h', '--help'
  puts <<-EOF
    USAGE: run_calorie_budgeter {DATA_FILE}

    DATA_FILE should be a YAML file with the following format:

    ----
    resting_metabolic_rate: 1950
    weekly_calorie_goal: 10_150

    1:
      calories_consumed: 1_998
      calories_burned: 182
    2:
      calories_consumed: 1_998
      calories_burned: 182
    3:
      calories_consumed: 1_998
      calories_burned: 182
    4:
      calories_consumed: 1_998
      calories_burned: 182
    5:
      calories_consumed: 1_998
      calories_burned: 182
    6:
      calories_consumed: 1_998
      calories_burned: 182
    7:
      calories_consumed: 1_998
      calories_burned: 182
    ----

    Each numbered section in the file corresponds to a day of the week, where:

    1: Monday
    2: Tuesday
    3: Wednesday
    4: Thursday
    5: Friday
    6: Saturday
    7: Sunday

    This program considers Monday to be the start of the dieting week (i.e. that
    is when the weekly calorie budget starts over).

  EOF
  exit
end

$:.unshift(File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib')))

require 'nutrition_calculator/calorie_budgeter'
require 'nutrition_calculator/data_summarizer'
require 'yaml'

def data
  @data ||= YAML.load_file(ARGV.first)
end

summarizer = NutritionCalculator::DataSummarizer.new(source_data: data)
cb = NutritionCalculator::CalorieBudgeter.new

# require 'logger'
# cb.logger = Logger.new(STDERR)
#
cb.resting_metabolic_rate = data['resting_metabolic_rate']
cb.weekly_calorie_goal = data['weekly_calorie_goal']

cb.num_days_to_budget = 8 - summarizer.current_day
cb.prior_days_calories = summarizer.prior_days_net_calories
cb.calories_burned = summarizer.calories_burned_today
cb.calories_consumed = summarizer.calories_consumed_today

puts "You have consumed #{cb.calories_consumed} calories today."
puts "You have burned #{cb.calories_burned} calories today."
puts "You need to consume #{cb.calories_remaining} more calories today to hit your target of #{cb.target_daily_calorie_consumption}."
puts "You need to exercise to burn off #{cb.exercise_calories_remaining} more calories today to hit your net calorie goal of #{cb.daily_calorie_goal}."
